<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments :: head}">
    <link rel="stylesheet" href="https://unpkg.com/tabulator-tables/dist/css/tabulator.min.css">
</head>
<body class="gradient-bg min-h-screen flex flex-col">
<!-- Header -->
<div th:replace="~{fragments :: header}"></div>

<!-- Main Content -->
<main class="container mx-auto px-4 py-12 flex-grow">
    <div class="glass-card p-8 rounded-2xl shadow-xl animate__animated animate__fadeIn">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-red-600 bg-clip-text text-transparent tracking-tight">Test Case Management</h1>
            <a th:href="@{/tcmasters/add}"
               class="btn glass-card px-6 py-2 rounded-lg text-blue-600 hover:text-blue-700 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg flex items-center gap-2">
                <i class="fas fa-plus"></i>
                <span class="tracking-tight">Add New Test Case</span>
            </a>
        </div>

        <div id="tcmasters-table"></div>
    </div>
</main>

<!-- Footer -->
<div th:replace="~{fragments :: footer}"></div>

<!-- Scripts -->
<div th:replace="~{fragments :: scripts}"></div>
<script src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var table = new Tabulator("#tcmasters-table", {
            layout: "fitDataStretch",
            responsiveLayout: "collapse",
            addRowPos: "top",
            columns: [
                {title: "ID", field: "tcId", editor: false},
                {title: "Name", field: "tcName", editor: "input"},
                {title: "Description", field: "description", editor: "textarea"},
                {title: "Created By", field: "createdBy", editor: false},
                {title: "Created Date", field: "createdDate", editor: false},
                {title: "Modified By", field: "modifiedBy", editor: "input"},
                {title: "Modified Date", field: "modifiedDate", editor: false},
                {title: "Status", field: "isActive", editor: "tickCross", formatter:"tickCross"},
                {title: "AIT No", field: "aitNo", editor: "input"},
                {title: "Config IDs", field: "configIds", editor: "input"},
                {title: "Actions", formatter: function(){ return "<button class='btn-delete'>Delete</button>"; }, cellClick:function(e, cell){
                    let row = cell.getRow();
                    if(confirm("Are you sure you want to delete this test case?")) {
                        row.delete();
                    }
                }}
            ],
            data: /*[[${tcmasters}]]*/ []
        });

        table.on("cellEdited", function(cell){
            let updatedData = cell.getData();
            fetch(`/tcmasters/update/${updatedData.tcId}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(updatedData)
            }).then(response => response.json())
              .then(data => console.log("Update Success", data))
              .catch(error => console.error("Update Failed", error));
        });
    });
</script>
</body>
</html>
